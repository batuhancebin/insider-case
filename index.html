<script>
    const htmlContent = `
  <div id="popup" class="modal">
      <div class="modal-content">
          <!-- Modal close button-->
          <span class="close-button" id="closeButton">&times;</span>
          <!-- Modal image section-->
          <div class="image-container">
              <img src="https://img.freepik.com/premium-photo/still-life-with-small-decorative-objects-with-vivid-colors_52683-100432.jpg"/>
          </div>
          <!-- Modal form codes-->
          <div id="modalContent"/>
  
      </div>
  </div>`;
  
    const formContainer = `
      <div class="form-container" id="formContainer">
          <div class="ictitle-container">
              <h1>Title</h1>
              <p>Description</p>
          </div>
          <div class="input-container">
              <input type="email" id="emailInput" placeholder="E-Mail"/>
              <input type="tel" id="phoneInput" placeholder="Phone Number"
              />
              <button id="submitButton">Submit</button>
              <div class="text-container">
                  <input type="checkbox" id="gdprCheckbox"/>
                  <label for="gdprCheckbox">
                      <a href="https://en.wikipedia.org/wiki/General_Data_Protection_Regulation" target="_blank">
                      By submitting this form, you are giving consent for your
                          e-mail to be used and disclosed. *
                      </a>
                  </label>
              </div>
          </div>
      </div>
      `;
  
    const couponContainer = `
      <div class="coupon-container" id="couponContainer">
          <h1>Amazing!</h1>
          <p>
              Here is your discount code you can use in your next order. This
              coupon code will be valid until 01.01.2020
          </p>
          <p class="coupon-text"> <span id="couponCode"></span></p>
          <button id="copyCouponButton">Copy</button>
      </div>
      `;
  
    const styles = `
  
  <style>
      .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          height: 100%;
          width: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          z-index: 9999;
      }
  
      .modal-content {
  
          position: relative;
          margin: 15% auto;
          max-width: 900px;
          height: 450px;
          background-color: #fff;
          border-radius: 5px;
          display: flex;
      }
      div#modalContent {
      display: flex;
  }
      .close-button {
          position: absolute;
          top: 10px;
          right: 10px;
          font-size: 18px;
          cursor: pointer;
      }
  
      .image-container {
          display: flex;
          justify-content: center;
          align-items: center;
          width: 50%;
      }
  
      .form-container {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 20px;
      }
  
      .form-container input:not([type="checkbox"]) {
          margin-bottom: 10px;
          padding: 10px;
          border: 1px solid #ced4da;
          border-radius: 5px;
          width: 100%;
          max-width: 300px;
      }
  
      .form-container input:focus {
          outline: none;
      }
  
      .form-container input:invalid {
          border-color: #dc3545;
      }
  
      .form-container input:valid {
          border-color: #28a745;
      }
  
      .form-container button {
          margin-top: 10px;
          padding: 10px;
          border: none;
          border-radius: 5px;
          width: 100%;
          max-width: 300px;
          background-color: #000;
          color: #fff;
          font-weight: bold;
          cursor: pointer;
      }
  
      .form-container button:hover {
          background-color: #0069d9;
      }
  
      .form-container button:focus {
          outline: none;
      }
  
      .input-container {
          width: 100%;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
      }
  
      .ictitle-container {
          width: 100%;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
      }
      .ictitle-container h1 {
          margin-bottom: 0px;
      }
  
  
      .image-container img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }
  
      .coupon-container {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 20px;
      }
  
      .coupon {
          flex-direction: column;
          align-items: center;
      }
  
      .coupon p {
          margin-bottom: 10px;
      }
  
      .coupon-text {
          width: 75%;
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: center;
          border-style: dashed;
          height: 40px;
      }
  
      .coupon-container button {
          margin-top: 10px;
          padding: 10px;
          border: none;
          border-radius: 5px;
          width: 100%;
          max-width: 300px;
          background-color: #000;
          color: #fff;
          font-weight: bold;
          cursor: pointer;
      }
  
      .coupon-container button:hover {
          background-color: #0069d9;
      }
  
      .coupon-container button:focus {
          outline: none;
      }
      @media screen and (max-width: 992px) {
          .modal-content {
          flex-direction: column;
          height: 75%;
          margin-right: 20px;
          margin-left: 20px;
          }
          .image-container {
          width: 100%;
          height: 25%;
          margin-bottom: 70px;
          }
  
          .form-container {
              width: 100%;
              height: 50%;
          }
  
          .form-container input:not([type="checkbox"]) {
              max-width: 100%;
          }
  
          .form-container button {
              max-width: 100%;
          }
  
          .coupon-container {
              width: 100%;
              height: 100%;
          }
  
          .coupon-container button {
              max-width: 100%;
          }
  
          .coupon-text {
              width: 100%;
          }
  
          .coupon-text span {
              width: 100%;
          }
    
      }
  </style>
  `;
  
    document.querySelector("head").innerHTML += styles;
    document.querySelector("body").innerHTML += htmlContent;
    document.querySelector("#modalContent").innerHTML = formContainer;
  
    // Elementleri seçme
    const popup = document.getElementById("popup"),
      overlay = document.querySelector(".overlay"),
      phoneInput = document.getElementById("phoneInput"),
      emailInput = document.getElementById("emailInput"),
      closeButton = document.getElementById("closeButton"),
      gdprTextLink = document.querySelector("#gdprText a"),
      gdprCheckbox = document.getElementById("gdprCheckbox"),
      submitButton = document.getElementById("submitButton");
  
    popup.style.display = "block";
  
    submitButton.addEventListener("click", () => {
      const email = emailInput.value.trim();
      const phone = phoneInput.value.trim();
  
      // E-posta ve telefon girişlerini doğrulama
      if (isValidEmail(email) && isValidPhone(phone) && gdprCheckbox.checked) {
        const data = {
          email: email,
          phone: phone,
        };
  
        sendLeadData(data);
      } else {
        alert(
          "Lütfen geçerli bir e-posta adresi, telefon numarası girin ve GDPR şartlarını kabul edin."
        );
      }
    });
    closeButton.addEventListener("click", () => {
      popup.style.display = "none";
    });
  
    closeButton.addEventListener("click", () => {
      hidePopup();
    });
  
    function sendLeadData(data) {
      const url = "https://opt-interview-projects.onrender.com/lead-collection";
  
      fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((result) => {
          if (result === "Invalid data") {
            alert("Geçersiz veri. Lütfen tekrar deneyin.");
          } else {
            showCoupon(result.coupon_code);
          }
        })
        .catch((error) => {
          console.error("API hatası:", error);
        });
    }
  
    function showCoupon(couponCode) {
      document.querySelector("#modalContent").innerHTML = couponContainer;
  
      const couponCodeElement = document.getElementById("couponCode"),
        copyCouponButton = document.getElementById("copyCouponButton");
  
      copyCouponButton.addEventListener("click", () => {
        const range = document.createRange();
        range.selectNode(couponCodeElement);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand("copy");
        window.getSelection().removeAllRanges();
        alert("Kupon kodu kopyalandı.");
      });
  
      couponCodeElement.innerText = couponCode;
    }
  
    // Popup'ı gizleme işlevi
    function hidePopup() {
      overlay.style.display = "none";
      popup.style.display = "none";
    }
  
    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }
  
    function isValidPhone(phone) {
      const phoneRegex = /^\d{10}$/;
      return phoneRegex.test(phone);
    }
  </script>
  